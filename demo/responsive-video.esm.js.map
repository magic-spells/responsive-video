{"version":3,"file":"responsive-video.esm.js","sources":["../src/responsive-video.js"],"sourcesContent":["/**\n * Responsive video loader that swaps sources based on viewport width.\n * Only the matching source is applied so mobile users never download the desktop asset (and vice versa).\n */\nexport class ResponsiveVideo extends HTMLElement {\n\t#videoEl = null;\n\t#currentSrc = null;\n\t#resizeRaf = 0;\n\t#boundResize = null;\n\n\tconnectedCallback() {\n\t\tthis.#videoEl = this.querySelector('video');\n\t\tif (!this.#videoEl) {\n\t\t\treturn;\n\t\t}\n\t\tthis.attachEvents();\n\t\tthis.updateSource();\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.detachEvents();\n\t}\n\n\t/**\n\t * Sets up listeners that keep the video source aligned with the viewport.\n\t */\n\tattachEvents() {\n\t\tif (typeof window === 'undefined' || this.#boundResize) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#boundResize = () => {\n\t\t\tif (this.#resizeRaf) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.#resizeRaf = requestAnimationFrame(() => {\n\t\t\t\tthis.#resizeRaf = 0;\n\t\t\t\tthis.updateSource();\n\t\t\t});\n\t\t};\n\n\t\twindow.addEventListener('resize', this.#boundResize, { passive: true });\n\t}\n\n\t/**\n\t * Removes listeners and cancels pending work.\n\t */\n\tdetachEvents() {\n\t\tif (typeof window !== 'undefined' && this.#boundResize) {\n\t\t\twindow.removeEventListener('resize', this.#boundResize);\n\t\t}\n\t\tif (this.#resizeRaf) {\n\t\t\tcancelAnimationFrame(this.#resizeRaf);\n\t\t\tthis.#resizeRaf = 0;\n\t\t}\n\t\tthis.#boundResize = null;\n\t}\n\n\t/**\n\t * Calculates which source should be active and updates the video if needed.\n\t */\n\tupdateSource() {\n\t\tif (!this.#videoEl) {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof window === 'undefined') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst breakpoint = this.#getBreakpoint();\n\t\tconst mobileVideo = this.getAttribute('mobile-video')?.trim() || '';\n\t\tconst desktopVideo = this.getAttribute('desktop-video')?.trim() || '';\n\t\tconst mobilePoster = this.getAttribute('mobile-poster')?.trim() || '';\n\t\tconst desktopPoster = this.getAttribute('desktop-poster')?.trim() || '';\n\t\tconst viewportWidth = window.innerWidth || 0;\n\n\t\tlet nextMode = null;\n\t\tlet nextVideo = '';\n\t\tlet nextPoster = '';\n\n\t\tif (viewportWidth >= breakpoint && desktopVideo) {\n\t\t\tnextMode = 'desktop';\n\t\t\tnextVideo = desktopVideo;\n\t\t\tnextPoster = desktopPoster;\n\t\t} else if (mobileVideo) {\n\t\t\tnextMode = 'mobile';\n\t\t\tnextVideo = mobileVideo;\n\t\t\tnextPoster = mobilePoster;\n\t\t} else if (desktopVideo) {\n\t\t\t// Fallback to desktop when mobile video is missing.\n\t\t\tnextMode = 'desktop';\n\t\t\tnextVideo = desktopVideo;\n\t\t\tnextPoster = desktopPoster;\n\t\t}\n\n\t\tif (!nextVideo) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (nextVideo === this.#currentSrc) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#applySource(nextVideo, nextPoster, nextMode);\n\t}\n\n\t#getBreakpoint() {\n\t\tconst attr = this.getAttribute('breakpoint');\n\t\tconst parsed = parseInt(attr ?? '', 10);\n\t\treturn Number.isFinite(parsed) && parsed > 0 ? parsed : 768;\n\t}\n\n\t#applySource(videoUrl, posterUrl, mode) {\n\t\tconst video = this.#videoEl;\n\t\tif (!video) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentSrc = video.getAttribute('src');\n\t\tif (currentSrc === videoUrl) {\n\t\t\tthis.#currentSrc = videoUrl;\n\t\t\tif (mode) {\n\t\t\t\tthis.dataset.activeMode = mode;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvideo.setAttribute('src', videoUrl);\n\n\t\tif (posterUrl) {\n\t\t\tvideo.setAttribute('poster', posterUrl);\n\t\t} else {\n\t\t\tvideo.removeAttribute('poster');\n\t\t}\n\n\t\tvideo.load();\n\n\t\tif (video.autoplay && typeof video.play === 'function') {\n\t\t\tconst playPromise = video.play();\n\t\t\tif (playPromise && typeof playPromise.catch === 'function') {\n\t\t\t\tplayPromise.catch(() => {\n\t\t\t\t\t// Most browsers require muted autoplay; ignore failures quietly.\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#currentSrc = videoUrl;\n\t\tif (mode) {\n\t\t\tthis.dataset.activeMode = mode;\n\t\t} else {\n\t\t\tdelete this.dataset.activeMode;\n\t\t}\n\t}\n}\n\nif (!customElements.get('responsive-video')) {\n\tcustomElements.define('responsive-video', ResponsiveVideo);\n}\n"],"names":[],"mappings":"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"}